## Azure Provider

The CloudQuery Azure provider pulls configuration out of Azure resources, normalizes them and stores them in PostgreSQL database.

### Install

 ```shell
 cloudquery init azure
 ```

### Authentication

To authenticate cloudquery with your Azure account you can use any of the following options (see full documentation at [AZURE SDK V2](https://github.com/Azure/azure-sdk-for-go#authentication)):

- Client Credentials: `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, `AZURE_CLIENT_SECRET`, `AZURE_SUBSCRIPTION_ID`
- Client Certificate: `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, `AZURE_CERTIFICATE_PATH`, `AZURE_CERTIFICATE_PASSWORD`, `AZURE_SUBSCRIPTION_ID`
- Resource Owner Password: `AZURE_TENANT_ID`, `AZURE_CLIENT_ID`, `AZURE_USERNAME`, `AZURE_PASSWORD`, `AZURE_SUBSCRIPTION_ID`

To have access to ad(Active Directory) resources the `app registration/user` should be [added](https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-users-assign-role-azure-portal) as Assignment to `Application administrator` role in Active Directory `Roles and administrators` section

To list keyvault's data each keyvault should have [access policy](https://docs.microsoft.com/en-us/azure/key-vault/general/assign-access-policy?tabs=azure-portal) that allows a principal(app registration, user) to get the data. 



### Configuration

The following configuration section can be automatically generated by `cloudquery init azure`:

 ```hcl
 provider "azure" {
  configuration {
    //  Optional. if you not specified, cloudquery tries to access all subscriptions available to tenant
    // subscriptions = ["<YOU_SUBSCRIPTION_ID_HERE>"]
  }
  
  resources = ["*"]
}
 ```

By default cloudquery will fetch all configuration from **all** resources in **all** subscription. You can change this behaviour with the following arguments:

- `subscriptions` **(Optional)** - Specify multiple subscriptions to fetch data from them concurrently.

### Query Examples

#### Find all mysql servers

 ```sql
 SELECT * FROM azure_mysql_servers;
 ```

#### Find storage accounts which allowing non https traffic

 ```sql
 SELECT * from azure_storage_accounts where enable_https_traffic_only = false;
 ```

#### Find all expired key vault

 ```sql
 SELECT * from azure_keyvault_vault_keys where attributes_expires >= extract(epoch from now()) * 1000;
 ```
