-- Autogenerated by migration tool on 2022-02-08 00:49:00
-- CHANGEME: Verify or edit this file before proceeding

-- Resource: network.virtual_networks
ALTER TABLE IF EXISTS "azure_network_virtual_network_subnets" DROP COLUMN IF EXISTS "ip_configurations";
ALTER TABLE IF EXISTS "azure_network_virtual_network_subnets" DROP COLUMN IF EXISTS "private_endpoints";


ALTER TABLE IF EXISTS azure_compute_virtual_machines
    DROP COLUMN IF EXISTS "windows_configuration_patch_settings_assessment_mode";
ALTER TABLE IF EXISTS azure_compute_virtual_machines
    DROP COLUMN IF EXISTS "linux_configuration_patch_settings_assessment_mode";
ALTER TABLE IF EXISTS azure_compute_virtual_machines
    DROP COLUMN IF EXISTS "network_profile_network_api_version";
ALTER TABLE IF EXISTS azure_compute_virtual_machines
    DROP COLUMN IF EXISTS "network_profile_network_interface_configurations";
ALTER TABLE IF EXISTS azure_compute_virtual_machines
    DROP COLUMN IF EXISTS "scheduled_events_profile";
ALTER TABLE IF EXISTS azure_compute_virtual_machines
    DROP COLUMN IF EXISTS "user_data";


ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    ADD COLUMN IF NOT EXISTS "virtual_machine_extension_properties" jsonb;
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "force_update_tag";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "publisher";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "type_handler_version";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "auto_upgrade_minor_version";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "enable_automatic_upgrade";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "settings";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "protected_settings";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "provisioning_state";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "extension_type";
ALTER TABLE IF EXISTS azure_compute_virtual_machine_resources
    DROP COLUMN IF EXISTS "instance_view";


CREATE TABLE IF NOT EXISTS "azure_compute_virtual_machine_network_interfaces"
(
    "cq_id"                                          uuid NOT NULL,
    "cq_meta"                                        jsonb,
    "virtual_machine_cq_id"                          uuid,
    "virtual_machine_id"                             text,
    "network_interface_reference_properties_primary" boolean,
    "id"                                             text,
    CONSTRAINT azure_compute_virtual_machine_network_interfaces_pk PRIMARY KEY (virtual_machine_cq_id, id),
    UNIQUE (cq_id),
    FOREIGN KEY (virtual_machine_cq_id) REFERENCES azure_compute_virtual_machines (cq_id) ON DELETE CASCADE
);

-- Resource: security.jit_network_access_policies
DROP TABLE IF EXISTS azure_security_jit_network_access_policy_virtual_machines;
DROP TABLE IF EXISTS azure_security_jit_network_access_policy_requests;
DROP TABLE IF EXISTS azure_security_jit_network_access_policies;

DROP TABLE IF EXISTS azure_resources_links;

DROP TABLE IF EXISTS azure_keyvault_managed_hsm;


